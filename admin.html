<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin ‚Äî Casuarina Snacks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0b1318;
            --surface: #121d24;
            --card: #182028;
            --card-h: #1e2c36;
            --border: #243040;
            --teal: #1bc4c0;
            --teal2: #0fa8a4;
            --orange: #f97316;
            --yellow: #fbbf24;
            --pink: #f472b6;
            --green: #34d399;
            --red: #f87171;
            --text: #f1f5f9;
            --muted: #8da8b8;
            --radius: 1rem;
            --rsm: .65rem;
            --trans: .22s cubic-bezier(.4, 0, .2, 1);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        /* LOGIN */
        #login-screen {
            position: fixed;
            inset: 0;
            z-index: 999;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        .login-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2.5rem 2rem;
            width: 100%;
            max-width: 360px;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            box-shadow: 0 24px 64px rgba(0, 0, 0, .6);
        }

        .login-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: .6rem;
        }

        .login-logo img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, .4), 0 6px 24px rgba(249, 115, 22, .2);
        }

        .login-logo .brand {
            font-size: 1.2rem;
            font-weight: 900;
        }

        .login-logo .brand span {
            color: var(--orange);
        }

        .login-logo .sub {
            font-size: .72rem;
            color: var(--teal);
            font-weight: 600;
            letter-spacing: .1em;
            text-transform: uppercase;
        }

        .login-title {
            font-size: 1.1rem;
            font-weight: 800;
            text-align: center;
            color: var(--muted);
        }

        .field label {
            display: block;
            font-size: .78rem;
            font-weight: 700;
            color: var(--muted);
            margin-bottom: .35rem;
            letter-spacing: .05em;
            text-transform: uppercase;
        }

        .field input {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            color: var(--text);
            font-family: inherit;
            font-size: .95rem;
            padding: .65rem .9rem;
            outline: none;
            transition: border-color var(--trans), box-shadow var(--trans);
        }

        .field input:focus {
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(27, 196, 192, .15);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--orange), var(--yellow));
            border: none;
            border-radius: var(--rsm);
            color: #111;
            font-family: inherit;
            font-weight: 800;
            font-size: 1rem;
            padding: .75rem;
            cursor: pointer;
            transition: transform var(--trans), box-shadow var(--trans);
        }

        .login-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 24px rgba(249, 115, 22, .4);
        }

        .login-error {
            text-align: center;
            font-size: .82rem;
            color: var(--red);
            background: rgba(248, 113, 113, .1);
            border: 1px solid rgba(248, 113, 113, .25);
            border-radius: var(--rsm);
            padding: .5rem .8rem;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* APP */
        #app {
            display: none;
        }

        #app.visible {
            display: block;
        }

        /* TOPBAR */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(11, 19, 24, .92);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: .75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: .75rem;
        }

        .topbar-logo img {
            width: 44px;
            height: 44px;
            object-fit: cover;
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(27, 196, 192, .35);
        }

        .topbar-title {
            font-size: 1rem;
            font-weight: 800;
        }

        .topbar-title span {
            color: var(--orange);
        }

        .topbar-sub {
            font-size: .68rem;
            color: var(--muted);
            font-weight: 600;
            letter-spacing: .08em;
            text-transform: uppercase;
        }

        .admin-pill {
            background: rgba(249, 115, 22, .15);
            border: 1px solid rgba(249, 115, 22, .3);
            color: var(--orange);
            font-size: .72rem;
            font-weight: 700;
            padding: .2rem .6rem;
            border-radius: 2rem;
            letter-spacing: .06em;
            text-transform: uppercase;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: .75rem;
        }

        .menu-link {
            display: flex;
            align-items: center;
            gap: .35rem;
            color: var(--muted);
            font-size: .85rem;
            font-weight: 600;
            text-decoration: none;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            padding: .4rem .8rem;
            transition: all var(--trans);
        }

        .menu-link:hover {
            border-color: var(--teal);
            color: var(--teal);
        }

        .logout-btn {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            color: var(--muted);
            font-family: inherit;
            font-size: .82rem;
            font-weight: 600;
            padding: .4rem .8rem;
            cursor: pointer;
            transition: all var(--trans);
        }

        .logout-btn:hover {
            border-color: var(--red);
            color: var(--red);
        }

        /* CONTENT */
        .content {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem 1.5rem 4rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* SECTION CARD */
        .section-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .section-head {
            padding: 1.1rem 1.4rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .section-head-left {
            display: flex;
            align-items: center;
            gap: .6rem;
        }

        .section-icon {
            font-size: 1.2rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 800;
        }

        .section-desc {
            font-size: .78rem;
            color: var(--muted);
            margin-top: .1rem;
        }

        .section-body {
            padding: 1.4rem;
        }

        /* STATUS TOGGLE */
        .status-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .status-info {
            display: flex;
            flex-direction: column;
            gap: .3rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            font-size: .9rem;
            font-weight: 800;
            padding: .4rem 1rem;
            border-radius: 2rem;
            border: 2px solid;
        }

        .status-badge.open {
            background: rgba(52, 211, 153, .12);
            border-color: rgba(52, 211, 153, .4);
            color: var(--green);
        }

        .status-badge.closed {
            background: rgba(248, 113, 113, .12);
            border-color: rgba(248, 113, 113, .4);
            color: var(--red);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: .2
            }
        }

        .status-hint {
            font-size: .78rem;
            color: var(--muted);
        }

        .toggle-btn {
            padding: .65rem 1.5rem;
            border: none;
            border-radius: var(--rsm);
            font-family: inherit;
            font-weight: 800;
            font-size: .95rem;
            cursor: pointer;
            transition: transform var(--trans), box-shadow var(--trans);
        }

        .toggle-btn.open-action {
            background: linear-gradient(135deg, var(--green), #059669);
            color: #fff;
        }

        .toggle-btn.close-action {
            background: linear-gradient(135deg, var(--red), #dc2626);
            color: #fff;
        }

        .toggle-btn:hover {
            transform: scale(1.04);
            box-shadow: 0 4px 20px rgba(0, 0, 0, .4);
        }

        /* ADD PRODUCT FORM */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: .35rem;
        }

        .form-field.full {
            grid-column: 1/-1;
        }

        .form-field label {
            font-size: .72rem;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .06em;
        }

        .form-field input,
        .form-field select,
        .form-field textarea {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            color: var(--text);
            font-family: inherit;
            font-size: .92rem;
            padding: .6rem .85rem;
            outline: none;
            transition: border-color var(--trans), box-shadow var(--trans);
        }

        .form-field textarea {
            resize: vertical;
            min-height: 72px;
        }

        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(27, 196, 192, .15);
        }

        .form-field select option {
            background: var(--card);
        }

        .emoji-row {
            display: flex;
            flex-wrap: wrap;
            gap: .4rem;
            margin-top: .3rem;
        }

        .emoji-opt {
            font-size: 1.3rem;
            cursor: pointer;
            padding: .2rem .3rem;
            border: 2px solid transparent;
            border-radius: .4rem;
            transition: all var(--trans);
        }

        .emoji-opt:hover {
            background: var(--card-h);
            border-color: var(--border);
        }

        .emoji-opt.selected {
            border-color: var(--teal);
            background: rgba(27, 196, 192, .12);
        }

        .badge-checks {
            display: flex;
            gap: .6rem;
            flex-wrap: wrap;
            margin-top: .3rem;
        }

        .badge-check {
            display: flex;
            align-items: center;
            gap: .3rem;
            font-size: .82rem;
            cursor: pointer;
        }

        .badge-check input {
            accent-color: var(--teal);
            width: 14px;
            height: 14px;
            cursor: pointer;
        }

        .add-product-btn {
            margin-top: 1.2rem;
            background: linear-gradient(135deg, var(--teal2), var(--teal));
            border: none;
            border-radius: var(--rsm);
            color: #0b1318;
            font-family: inherit;
            font-weight: 800;
            font-size: .95rem;
            padding: .7rem 1.6rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            transition: transform var(--trans), box-shadow var(--trans);
        }

        .add-product-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 20px rgba(27, 196, 192, .35);
        }

        .add-product-btn:disabled {
            opacity: .5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* PRODUCT LIST */
        .products-controls {
            display: flex;
            align-items: center;
            gap: .7rem;
            flex-wrap: wrap;
            margin-bottom: 1.1rem;
        }

        .filter-btn {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 2rem;
            color: var(--muted);
            font-family: inherit;
            font-size: .82rem;
            font-weight: 600;
            padding: .35rem .85rem;
            cursor: pointer;
            transition: all var(--trans);
        }

        .filter-btn:hover {
            border-color: var(--teal);
            color: var(--text);
        }

        .filter-btn.active {
            background: var(--teal);
            border-color: var(--teal);
            color: #0b1318;
            font-weight: 800;
        }

        .count-pill {
            margin-left: auto;
            font-size: .78rem;
            color: var(--muted);
            font-weight: 600;
        }

        .prod-list {
            display: flex;
            flex-direction: column;
            gap: .6rem;
        }

        .prod-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            display: flex;
            align-items: center;
            gap: .9rem;
            padding: .75rem 1rem;
            transition: border-color var(--trans), opacity var(--trans);
        }

        .prod-item.unavailable {
            opacity: .55;
        }

        .prod-item.unavailable .prod-name {
            text-decoration: line-through;
            color: var(--muted);
        }

        .prod-emoji {
            font-size: 1.8rem;
            flex-shrink: 0;
            width: 2.4rem;
            text-align: center;
        }

        .prod-info {
            flex: 1;
            min-width: 0;
        }

        .prod-name {
            font-size: .93rem;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .prod-meta {
            font-size: .75rem;
            color: var(--muted);
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
            margin-top: .1rem;
            align-items: center;
        }

        .prod-cat {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 2rem;
            padding: .05rem .4rem;
            font-size: .68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .05em;
        }

        .prod-price {
            font-size: .85rem;
            font-weight: 800;
            color: var(--yellow);
        }

        .prod-badges {
            display: flex;
            gap: .25rem;
        }

        .pb {
            font-size: .6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: .04em;
            padding: .12rem .35rem;
            border-radius: .25rem;
        }

        .pb-hot {
            background: var(--orange);
            color: #fff;
        }

        .pb-new {
            background: var(--teal);
            color: #0b1318;
        }

        .pb-pop {
            background: var(--pink);
            color: #fff;
        }

        .prod-actions {
            display: flex;
            align-items: center;
            gap: .5rem;
            flex-shrink: 0;
        }

        .avail-toggle {
            display: flex;
            align-items: center;
            gap: .4rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            cursor: pointer;
            font-size: .78rem;
            font-weight: 700;
            padding: .3rem .6rem;
            transition: all var(--trans);
            white-space: nowrap;
        }

        .avail-toggle.available {
            border-color: rgba(52, 211, 153, .4);
            color: var(--green);
        }

        .avail-toggle.unavailable {
            border-color: rgba(248, 113, 113, .3);
            color: var(--red);
        }

        .avail-toggle:hover {
            transform: scale(1.03);
        }

        .delete-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            color: var(--muted);
            width: 2rem;
            height: 2rem;
            cursor: pointer;
            display: grid;
            place-items: center;
            font-size: .9rem;
            transition: all var(--trans);
        }

        .delete-btn:hover {
            border-color: var(--red);
            color: var(--red);
            background: rgba(248, 113, 113, .08);
        }

        .prod-empty {
            text-align: center;
            padding: 2.5rem;
            color: var(--muted);
            font-size: .9rem;
        }

        .prod-empty .ei {
            font-size: 2rem;
            margin-bottom: .4rem;
        }

        /* SEED btn */
        .seed-btn {
            background: rgba(251, 191, 36, .12);
            border: 1px solid rgba(251, 191, 36, .3);
            border-radius: var(--rsm);
            color: var(--yellow);
            font-family: inherit;
            font-size: .82rem;
            font-weight: 700;
            padding: .4rem .9rem;
            cursor: pointer;
            transition: all var(--trans);
        }

        .seed-btn:hover {
            background: rgba(251, 191, 36, .2);
        }

        /* TOAST */
        .toast-wrap {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: .45rem;
            align-items: center;
            pointer-events: none;
        }

        .toast {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            padding: .55rem 1.1rem;
            font-size: .87rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: .45rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .5);
            animation: tIn .25s ease, tOut .25s ease 1.75s forwards;
            white-space: nowrap;
        }

        @keyframes tIn {
            from {
                opacity: 0;
                transform: translateY(10px)
            }

            to {
                opacity: 1;
                transform: none
            }
        }

        @keyframes tOut {
            to {
                opacity: 0;
                transform: translateY(10px)
            }
        }

        /* CONFIRM MODAL */
        .confirm-overlay {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(0, 0, 0, .7);
            backdrop-filter: blur(4px);
            display: grid;
            place-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--trans);
        }

        .confirm-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        .confirm-box {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2rem 1.8rem;
            width: min(400px, 92vw);
            text-align: center;
            transform: scale(.92);
            transition: transform var(--trans);
        }

        .confirm-overlay.open .confirm-box {
            transform: scale(1);
        }

        .confirm-icon {
            font-size: 2.5rem;
            margin-bottom: .6rem;
        }

        .confirm-box h3 {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: .4rem;
        }

        .confirm-box p {
            color: var(--muted);
            font-size: .87rem;
            margin-bottom: 1.4rem;
        }

        .confirm-btns {
            display: flex;
            gap: .7rem;
            justify-content: center;
        }

        .confirm-cancel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--rsm);
            color: var(--muted);
            font-family: inherit;
            font-size: .9rem;
            font-weight: 700;
            padding: .6rem 1.3rem;
            cursor: pointer;
            transition: all var(--trans);
        }

        .confirm-cancel:hover {
            border-color: var(--muted);
            color: var(--text);
        }

        .confirm-ok {
            background: linear-gradient(135deg, var(--red), #dc2626);
            border: none;
            border-radius: var(--rsm);
            color: #fff;
            font-family: inherit;
            font-size: .9rem;
            font-weight: 800;
            padding: .6rem 1.3rem;
            cursor: pointer;
            transition: transform var(--trans);
        }

        .confirm-ok:hover {
            transform: scale(1.04);
        }

        /* SYNC INDICATOR */
        .sync-indicator {
            display: flex;
            align-items: center;
            gap: .35rem;
            font-size: .72rem;
            color: var(--teal);
            font-weight: 600;
        }

        .sync-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--teal);
            animation: blink 1.5s ease-in-out infinite;
        }

        @media (max-width:580px) {
            .content {
                padding: 1.2rem 1rem 3rem;
            }

            .section-body {
                padding: 1rem;
            }

            .topbar {
                padding: .7rem 1rem;
            }

            .prod-item {
                flex-wrap: wrap;
            }

            .prod-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>

<body>

    <!-- LOGIN -->
    <div id="login-screen">
        <div class="login-card">
            <div class="login-logo">
                <img src="casuarina.jpeg" alt="Logo" onerror="this.style.display='none'" />
                <div class="brand">Casuarina <span>Snacks</span></div>
                <div class="sub">Panel de Administraci√≥n</div>
            </div>
            <div class="login-title">üîê Acceso privado</div>
            <div class="field">
                <label>Contrase√±a</label>
                <input type="password" id="pwd-input" placeholder="Ingresa la contrase√±a..."
                    autocomplete="current-password" />
            </div>
            <div class="login-error" id="login-error">Contrase√±a incorrecta. Intenta de nuevo.</div>
            <button class="login-btn" id="login-btn">Entrar al panel ‚Üí</button>
        </div>
    </div>

    <!-- APP -->
    <div id="app">
        <header class="topbar">
            <div class="topbar-left">
                <div class="topbar-logo"><img src="casuarina.jpeg" alt="Logo" onerror="this.style.display='none'" />
                </div>
                <div>
                    <div class="topbar-title">Casuarina <span>Admin</span></div>
                    <div class="topbar-sub">Panel de control</div>
                </div>
                <span class="admin-pill">Admin</span>
                <div class="sync-indicator" id="sync-indicator" style="display:none">
                    <span class="sync-dot"></span> Sincronizado con Firebase
                </div>
            </div>
            <div class="topbar-right">
                <a class="menu-link" href="index.html" target="_blank">üëÅ Ver men√∫</a>
                <button class="logout-btn" id="logout-btn">Cerrar sesi√≥n</button>
            </div>
        </header>

        <div class="content">
            <!-- STATUS -->
            <div class="section-card">
                <div class="section-head">
                    <div class="section-head-left">
                        <span class="section-icon">üè™</span>
                        <div>
                            <div class="section-title">Estado del negocio</div>
                            <div class="section-desc">Controla si el men√∫ muestra "Abierto" o "Cerrado"</div>
                        </div>
                    </div>
                </div>
                <div class="section-body">
                    <div class="status-row">
                        <div class="status-info">
                            <div class="status-badge open" id="status-badge"><span class="status-dot"></span><span
                                    id="status-text">Abierto</span></div>
                            <div class="status-hint" id="status-hint">El men√∫ muestra el indicador verde de "Abierto"
                            </div>
                        </div>
                        <button class="toggle-btn close-action" id="status-toggle-btn">üîí Marcar como Cerrado</button>
                    </div>
                </div>
            </div>

            <!-- ADD PRODUCT -->
            <div class="section-card">
                <div class="section-head">
                    <div class="section-head-left">
                        <span class="section-icon">‚ûï</span>
                        <div>
                            <div class="section-title">Agregar producto</div>
                            <div class="section-desc">Llena los datos para a√±adir un nuevo √≠tem al men√∫</div>
                        </div>
                    </div>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-field">
                            <label>Nombre del producto *</label>
                            <input type="text" id="f-name" placeholder="Ej. Papas con Habanero" maxlength="50" />
                        </div>
                        <div class="form-field">
                            <label>Precio (MXN) *</label>
                            <input type="number" id="f-price" placeholder="Ej. 35" min="1" max="9999" />
                        </div>
                        <div class="form-field">
                            <label>Categor√≠a *</label>
                            <select id="f-cat">
                                <option value="">‚Äî Selecciona ‚Äî</option>
                                <option value="snacks">üçø Snacks</option>
                                <option value="dulces">üç¨ Dulces</option>
                                <option value="bebidas-frias">üßÉ Bebidas Fr√≠as</option>
                                <option value="bebidas-calientes">‚òï Bebidas Calientes</option>
                                <option value="saludable">ü•ó Saludable</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label>Emoji del producto *</label>
                            <input type="text" id="f-emoji" placeholder="üçø" maxlength="4" style="font-size:1.3rem" />
                            <div class="emoji-row" id="emoji-row"></div>
                        </div>
                        <div class="form-field full">
                            <label>Descripci√≥n</label>
                            <textarea id="f-desc" placeholder="Breve descripci√≥n del producto..."
                                maxlength="120"></textarea>
                        </div>
                        <div class="form-field full">
                            <label>Etiquetas (badges)</label>
                            <div class="badge-checks">
                                <label class="badge-check"><input type="checkbox" id="b-hot" /> üî• Favorito</label>
                                <label class="badge-check"><input type="checkbox" id="b-new" /> ‚ú® Nuevo</label>
                                <label class="badge-check"><input type="checkbox" id="b-pop" /> ‚≠ê Popular</label>
                            </div>
                        </div>
                    </div>
                    <button class="add-product-btn" id="add-product-btn">‚úö Agregar al men√∫</button>
                </div>
            </div>

            <!-- PRODUCT LIST -->
            <div class="section-card">
                <div class="section-head">
                    <div class="section-head-left">
                        <span class="section-icon">üìã</span>
                        <div>
                            <div class="section-title">Productos en el men√∫</div>
                            <div class="section-desc">Activa/desactiva disponibilidad o elimina productos</div>
                        </div>
                    </div>
                    <button class="seed-btn" id="seed-btn" title="Cargar productos de ejemplo a Firestore">‚¨Ü Cargar
                        productos de ejemplo</button>
                </div>
                <div class="section-body">
                    <div class="products-controls">
                        <button class="filter-btn active" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="avail">‚úÖ Disponibles</button>
                        <button class="filter-btn" data-filter="out">‚õî Sin inventario</button>
                        <span class="count-pill" id="prod-count-pill">‚Äî productos</span>
                    </div>
                    <div class="prod-list" id="prod-list">
                        <div class="prod-empty">
                            <div class="ei">‚è≥</div>
                            <p>Conectando con Firebase...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div class="confirm-overlay" id="confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-icon">üóëÔ∏è</div>
            <h3>¬øEliminar producto?</h3>
            <p id="confirm-text">Esta acci√≥n no se puede deshacer.</p>
            <div class="confirm-btns">
                <button class="confirm-cancel" id="confirm-cancel">Cancelar</button>
                <button class="confirm-ok" id="confirm-ok">S√≠, eliminar</button>
            </div>
        </div>
    </div>

    <div class="toast-wrap" id="toast-wrap"></div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMIN MODULE SCRIPT ‚Äî Firebase + UI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script type="module">
        import { db } from './firebase-config.js';
        import {
            collection, doc, addDoc, updateDoc, deleteDoc,
            onSnapshot, setDoc, getDocs, writeBatch
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        /* ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ */
        const ADMIN_PASSWORD = 'casuarina2024'; // ‚Üê cambia aqu√≠ tu contrase√±a
        const COL_PRODUCTOS = 'productos';
        const DOC_NEGOCIO = doc(db, 'config', 'negocio');

        const DEFAULT_PRODUCTS = [
            { name: 'Palomitas de Ma√≠z', desc: 'Palomitas reci√©n hechas con mantequilla y sal.', price: 25, emoji: 'üçø', cat: 'snacks', badges: ['hot'] },
            { name: 'Papas Fritas', desc: 'Crujientes papas estilo kettle, en varios sabores.', price: 30, emoji: 'ü•î', cat: 'snacks', badges: ['pop'] },
            { name: 'Nachos con Queso', desc: 'Nachos dorados ba√±ados en salsa de queso caliente.', price: 45, emoji: 'ü´î', cat: 'snacks', badges: [] },
            { name: 'Hot Cheetos', desc: 'Botana de ma√≠z muy picosa, crujiente y adictiva.', price: 20, emoji: 'üå∂Ô∏è', cat: 'snacks', badges: ['pop'] },
            { name: 'Palomitas Ranch', desc: 'Palomitas sabor ranch con toque de queso.', price: 30, emoji: 'üçø', cat: 'snacks', badges: ['new'] },
            { name: 'Cacahuates Japones', desc: 'Cacahuates cubiertos de harina crujiente japonesa.', price: 18, emoji: 'ü•ú', cat: 'snacks', badges: [] },
            { name: 'Gomitas de Osito', desc: 'Gomitas de colores con sabores de frutas tropicales.', price: 15, emoji: 'üêª', cat: 'dulces', badges: ['pop'] },
            { name: 'Chocolates Surtidos', desc: 'Selecci√≥n de chocolates, leche, oscuro y almendra.', price: 35, emoji: 'üç´', cat: 'dulces', badges: [] },
            { name: 'Paleta de Tamarindo', desc: 'Paleta con chamoy, tamarindo y chile en polvo.', price: 12, emoji: 'üç≠', cat: 'dulces', badges: ['hot'] },
            { name: 'Mazap√°n', desc: 'Tradicional mazap√°n de cacahuate, suave y dulce.', price: 8, emoji: 'üü§', cat: 'dulces', badges: [] },
            { name: 'Rebanada de Pay', desc: 'Pay de manzana casero con canela y az√∫car.', price: 40, emoji: 'ü•ß', cat: 'dulces', badges: ['new'] },
            { name: 'Agua Fresca', desc: 'Agua de sand√≠a, horchata o jamaica. Refrescante.', price: 20, emoji: 'üçπ', cat: 'bebidas-frias', badges: ['pop'] },
            { name: 'Limonada', desc: 'Limonada natural con menta fresca y hielo.', price: 25, emoji: 'üçã', cat: 'bebidas-frias', badges: [] },
            { name: 'Smoothie de Fresa', desc: 'Batido de fresas naturales, leche y vainilla.', price: 40, emoji: 'üçì', cat: 'bebidas-frias', badges: ['new'] },
            { name: 'Refresco', desc: 'Variedad de refrescos fr√≠os de tu elecci√≥n.', price: 22, emoji: 'ü•§', cat: 'bebidas-frias', badges: [] },
            { name: 'Agua Mineral', desc: 'Agua mineral natural con gas para refrescarte.', price: 15, emoji: 'üíß', cat: 'bebidas-frias', badges: [] },
            { name: 'T√© Fr√≠o de Lim√≥n', desc: 'T√© helado con lim√≥n y miel, perfecto para el calor.', price: 28, emoji: 'üçµ', cat: 'bebidas-frias', badges: ['hot'] },
            { name: 'Caf√© Americano', desc: 'Caf√© de grano negro fuerte, servido bien caliente.', price: 30, emoji: '‚òï', cat: 'bebidas-calientes', badges: ['pop'] },
            { name: 'Caf√© con Leche', desc: 'Espresso suave con leche vaporizada y canela.', price: 35, emoji: 'üßã', cat: 'bebidas-calientes', badges: [] },
            { name: 'Chocolate Caliente', desc: 'Chocolate espeso cremoso con malvaviscos.', price: 38, emoji: 'üç´', cat: 'bebidas-calientes', badges: ['hot'] },
            { name: 'T√© de Manzanilla', desc: 'Tranquilo t√© de manzanilla con miel y lim√≥n.', price: 20, emoji: 'üåº', cat: 'bebidas-calientes', badges: [] },
            { name: 'Ensalada de Frutas', desc: 'Fruta fresca de temporada con chile y lim√≥n.', price: 35, emoji: 'üç±', cat: 'saludable', badges: ['new'] },
            { name: 'Mix de Nueces', desc: 'Mezcla de nueces, almendras y ar√°ndanos secos.', price: 45, emoji: 'ü•ú', cat: 'saludable', badges: [] },
            { name: 'Granola Bar', desc: 'Barra de granola con avena, miel y semillas.', price: 25, emoji: 'üåæ', cat: 'saludable', badges: ['pop'] },
            { name: 'Yogurt con Granola', desc: 'Yogurt natural con granola crujiente y miel.', price: 40, emoji: 'ü•õ', cat: 'saludable', badges: [] },
        ];

        /* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
        let liveProducts = [];    // populated by onSnapshot
        let liveStatus = 'open';
        let activeFilter = 'all';
        let pendingDeleteId = null;

        /* ‚îÄ‚îÄ DOM REFS ‚îÄ‚îÄ */
        const loginScreen = document.getElementById('login-screen');
        const app = document.getElementById('app');
        const pwdInput = document.getElementById('pwd-input');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        const statusBadge = document.getElementById('status-badge');
        const statusText = document.getElementById('status-text');
        const statusHint = document.getElementById('status-hint');
        const statusToggle = document.getElementById('status-toggle-btn');
        const prodList = document.getElementById('prod-list');
        const countPill = document.getElementById('prod-count-pill');
        const toastWrap = document.getElementById('toast-wrap');
        const confirmOverlay = document.getElementById('confirm-overlay');
        const confirmTextEl = document.getElementById('confirm-text');
        const confirmOk = document.getElementById('confirm-ok');
        const confirmCancel = document.getElementById('confirm-cancel');
        const syncIndicator = document.getElementById('sync-indicator');
        const addProductBtn = document.getElementById('add-product-btn');

        /* ‚îÄ‚îÄ CAT NAMES ‚îÄ‚îÄ */
        const CAT_NAMES = { snacks: 'Snack', dulces: 'Dulce', 'bebidas-frias': 'Beb. Fr√≠a', 'bebidas-calientes': 'Beb. Caliente', saludable: 'Saludable' };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function doLogin() {
            if (pwdInput.value === ADMIN_PASSWORD) {
                loginScreen.style.display = 'none';
                app.classList.add('visible');
                initApp();
            } else {
                loginError.classList.add('show');
                pwdInput.value = '';
                pwdInput.focus();
            }
        }
        loginBtn.addEventListener('click', doLogin);
        pwdInput.addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
        document.getElementById('logout-btn').addEventListener('click', () => {
            app.classList.remove('visible');
            loginScreen.style.display = 'flex';
            pwdInput.value = '';
            loginError.classList.remove('show');
        });

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function initApp() {
            initEmojiPicker();
            startListeners();
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIRESTORE LISTENERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function startListeners() {
            // Products ‚Äî real-time
            onSnapshot(collection(db, COL_PRODUCTOS), (snap) => {
                liveProducts = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() }));
                syncIndicator.style.display = 'flex';
                renderProductList();
            }, err => { toast('‚ùå Error al conectar con Firebase', true); console.error(err); });

            // Status ‚Äî real-time
            onSnapshot(DOC_NEGOCIO, (snap) => {
                liveStatus = snap.exists() ? (snap.data().status || 'open') : 'open';
                renderStatus();
            }, console.error);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATUS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderStatus() {
            if (liveStatus === 'open') {
                statusBadge.className = 'status-badge open';
                statusText.textContent = 'Abierto';
                statusHint.textContent = 'El men√∫ muestra el indicador verde de "Abierto"';
                statusToggle.className = 'toggle-btn close-action';
                statusToggle.textContent = 'üîí Marcar como Cerrado';
            } else {
                statusBadge.className = 'status-badge closed';
                statusText.textContent = 'Cerrado';
                statusHint.textContent = 'El men√∫ muestra el banner de "Cerrado" a los clientes';
                statusToggle.className = 'toggle-btn open-action';
                statusToggle.textContent = 'üîì Marcar como Abierto';
            }
        }

        statusToggle.addEventListener('click', async () => {
            const next = liveStatus === 'open' ? 'closed' : 'open';
            try {
                await setDoc(DOC_NEGOCIO, { status: next });
                toast(next === 'closed' ? 'üîí Negocio marcado como Cerrado' : 'üîì Negocio marcado como Abierto');
            } catch (e) { toast('‚ùå Error al actualizar estado', true); console.error(e); }
        });

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD PRODUCT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        initEmojiPickerSetup(); // declared below
        function initEmojiPickerSetup() { } // placeholder ‚Äî called after DOM ready

        function initEmojiPicker() {
            const row = document.getElementById('emoji-row');
            const emojis = ['üçø', 'ü•î', 'üåÆ', 'üå≠', 'üßÜ', 'ü•ú', 'üç´', 'üç¨', 'üç≠', 'üßÅ', 'ü•ß', 'üç∞', 'üçπ', 'üßÉ', 'ü•§', '‚òï', 'üßã', 'üçµ', 'üíß', 'üçì', 'üçã', 'üçé', 'ü•ó', 'üåæ', 'ü•õ', 'üå∂Ô∏è', 'üêª', 'üü§', 'üç∫', 'ü´î'];
            emojis.forEach(e => {
                const btn = document.createElement('span');
                btn.className = 'emoji-opt'; btn.textContent = e; btn.title = e;
                btn.addEventListener('click', () => {
                    document.getElementById('f-emoji').value = e;
                    document.querySelectorAll('.emoji-opt').forEach(x => x.classList.remove('selected'));
                    btn.classList.add('selected');
                });
                row.appendChild(btn);
            });
            document.getElementById('f-emoji').addEventListener('input', function () {
                document.querySelectorAll('.emoji-opt').forEach(x => x.classList.toggle('selected', x.textContent === this.value.trim()));
            });
        }

        addProductBtn.addEventListener('click', async () => {
            const name = document.getElementById('f-name').value.trim();
            const price = parseFloat(document.getElementById('f-price').value);
            const cat = document.getElementById('f-cat').value;
            const emoji = document.getElementById('f-emoji').value.trim() || 'üçø';
            const desc = document.getElementById('f-desc').value.trim();
            const badges = [];
            if (document.getElementById('b-hot').checked) badges.push('hot');
            if (document.getElementById('b-new').checked) badges.push('new');
            if (document.getElementById('b-pop').checked) badges.push('pop');

            if (!name) return toast('‚ö†Ô∏è Escribe el nombre del producto', true);
            if (!price || price <= 0) return toast('‚ö†Ô∏è Ingresa un precio v√°lido', true);
            if (!cat) return toast('‚ö†Ô∏è Selecciona una categor√≠a', true);

            addProductBtn.disabled = true;
            addProductBtn.textContent = '‚è≥ Guardando...';
            try {
                await addDoc(collection(db, COL_PRODUCTOS), { name, price, cat, emoji, desc, badges, available: true });
                toast(`‚úÖ "${name}" agregado al men√∫`);
                // Reset form
                ['f-name', 'f-price', 'f-desc', 'f-emoji'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('f-cat').value = '';
                ['b-hot', 'b-new', 'b-pop'].forEach(id => document.getElementById(id).checked = false);
                document.querySelectorAll('.emoji-opt').forEach(x => x.classList.remove('selected'));
            } catch (e) { toast('‚ùå Error al guardar producto', true); console.error(e); }
            addProductBtn.disabled = false;
            addProductBtn.innerHTML = '‚úö Agregar al men√∫';
        });

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRODUCT LIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeFilter = btn.dataset.filter;
                renderProductList();
            });
        });

        function renderProductList() {
            let filtered = liveProducts;
            if (activeFilter === 'avail') filtered = liveProducts.filter(p => p.available !== false);
            if (activeFilter === 'out') filtered = liveProducts.filter(p => p.available === false);

            countPill.textContent = `${filtered.length} producto${filtered.length !== 1 ? 's' : ''}`;
            prodList.innerHTML = '';

            if (filtered.length === 0) {
                prodList.innerHTML = `<div class="prod-empty"><div class="ei">üóÇÔ∏è</div><p>${liveProducts.length === 0 ? 'Sin productos. Usa "Cargar productos de ejemplo" para empezar.' : 'No hay productos en esta categor√≠a.'}</p></div>`;
                return;
            }

            filtered.forEach(p => {
                const isAvail = p.available !== false;
                const badgeHTML = (p.badges || []).map(b => {
                    const cl = { hot: 'pb-hot', new: 'pb-new', pop: 'pb-pop' }[b] || '';
                    const lb = { hot: 'Favorito', new: 'Nuevo', pop: 'Popular' }[b] || b;
                    return `<span class="pb ${cl}">${lb}</span>`;
                }).join('');

                const row = document.createElement('div');
                row.className = `prod-item ${isAvail ? '' : 'unavailable'}`;
                row.innerHTML = `
        <div class="prod-emoji">${p.emoji || 'üçø'}</div>
        <div class="prod-info">
          <div class="prod-name">${p.name}</div>
          <div class="prod-meta">
            <span class="prod-cat">${CAT_NAMES[p.cat] || p.cat}</span>
            <span class="prod-price">$${p.price} MXN</span>
            <div class="prod-badges">${badgeHTML}</div>
          </div>
        </div>
        <div class="prod-actions">
          <button class="avail-toggle ${isAvail ? 'available' : 'unavailable'}" data-id="${p.firestoreId}">
            ${isAvail ? '‚úÖ Disponible' : '‚õî Sin inventario'}
          </button>
          <button class="delete-btn" data-id="${p.firestoreId}" title="Eliminar">üóë</button>
        </div>`;
                prodList.appendChild(row);
            });

            prodList.querySelectorAll('.avail-toggle').forEach(btn => btn.addEventListener('click', () => toggleAvailability(btn.dataset.id)));
            prodList.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', () => askDelete(btn.dataset.id)));
        }

        async function toggleAvailability(firestoreId) {
            const p = liveProducts.find(x => x.firestoreId === firestoreId);
            if (!p) return;
            try {
                await updateDoc(doc(db, COL_PRODUCTOS, firestoreId), { available: !p.available });
                toast(p.available ? `‚õî "${p.name}" marcado sin inventario` : `‚úÖ "${p.name}" marcado disponible`);
            } catch (e) { toast('‚ùå Error al actualizar disponibilidad', true); console.error(e); }
        }

        /* ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ */
        function askDelete(firestoreId) {
            const p = liveProducts.find(x => x.firestoreId === firestoreId);
            if (!p) return;
            pendingDeleteId = firestoreId;
            confirmTextEl.textContent = `¬øEliminar "${p.name}" del men√∫? Esta acci√≥n no se puede deshacer.`;
            confirmOverlay.classList.add('open');
        }
        confirmCancel.addEventListener('click', () => { confirmOverlay.classList.remove('open'); pendingDeleteId = null; });
        confirmOverlay.addEventListener('click', e => { if (e.target === confirmOverlay) { confirmOverlay.classList.remove('open'); pendingDeleteId = null; } });
        confirmOk.addEventListener('click', async () => {
            if (!pendingDeleteId) return;
            try {
                await deleteDoc(doc(db, COL_PRODUCTOS, pendingDeleteId));
                toast('üóëÔ∏è Producto eliminado del men√∫');
            } catch (e) { toast('‚ùå Error al eliminar', true); console.error(e); }
            confirmOverlay.classList.remove('open');
            pendingDeleteId = null;
        });

        /* ‚îÄ‚îÄ SEED DEFAULT PRODUCTS ‚îÄ‚îÄ */
        document.getElementById('seed-btn').addEventListener('click', async () => {
            const snap = await getDocs(collection(db, COL_PRODUCTOS));
            if (!snap.empty) {
                const ok = confirm(`Ya hay ${snap.size} productos en Firebase. ¬øAgregar los ${DEFAULT_PRODUCTS.length} de ejemplo igualmente?`);
                if (!ok) return;
            }
            const batch = writeBatch(db);
            DEFAULT_PRODUCTS.forEach(p => {
                const ref = doc(collection(db, COL_PRODUCTOS));
                batch.set(ref, { ...p, available: true });
            });
            await batch.commit();
            toast(`‚úÖ ${DEFAULT_PRODUCTS.length} productos de ejemplo cargados a Firebase`);
        });

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        function toast(msg, warn = false) {
            const t = document.createElement('div');
            t.className = 'toast';
            if (warn) t.style.borderColor = 'rgba(251,191,36,.4)';
            t.textContent = msg;
            toastWrap.appendChild(t);
            setTimeout(() => t.remove(), 2200);
        }
    </script>
</body>

</html>
